/* ************************************************************************** */
/*                                                                            */
/*                                                        :::      ::::::::   */
/*   color.c                                            :+:      :+:    :+:   */
/*                                                    +:+ +:+         +:+     */
/*   By: mpivet-p <marvin@42.fr>                    +#+  +:+       +#+        */
/*                                                +#+#+#+#+#+   +#+           */
/*   Created: 2019/08/08 23:35:01 by mpivet-p          #+#    #+#             */
/*   Updated: 2019/08/08 23:52:15 by mpivet-p         ###   ########.fr       */
/*                                                                            */
/* ************************************************************************** */

#include <math.h>
#include "rtv1.h"
#include "libft.h"

double	get_diffuse_color(t_ray *ray, t_vector *light_vector, t_vector *position)
{
	double		angle;

 	angle = dot_product(get_normal(ray, *position), vector_mult(*light_vector, -1));
	if (angle > 0)
		return (angle);
	return (0);
}

double	get_ambient_color(void)
{
	return (0.1);
}

double	get_specular_color(t_ray *ray, t_vector *light_vector, t_vector *position)
{
	t_vector	reflect_dir;
	double	spec;

	reflect_dir = reflect(vector_mult(*light_vector, -1), get_normal(ray, *position));
	spec = pow(ft_max(dot_product(ray->dir, reflect_dir), 0.0), 32);
	return (0.5 * spec * 1);
}

void	get_color(t_ray *ray, t_vector *light_pos)
{
	t_vector	position;
	t_vector	light_vector;
	double		coeff;

 	position = add_vectors(ray->origin, vector_mult(ray->dir, ray->t));			//position de contact du rayon
 	light_vector = normalize(sub_vectors(position, *light_pos));				//Vecteur directeur (unitaire) du rayon qui va vers la lumiere (position - pos_light)
	coeff = get_ambient_color()
		+ get_diffuse_color(ray, &light_vector, &position)
		;//+ get_specular_color(ray, &light_vector, &position);
	ray->color = mult_color(ray->hit_by->color, coeff);
}

